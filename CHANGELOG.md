# Changelog

## v2.0.0 (2026-02-21)

### 🆕 新功能

#### 情绪压力系统 🧠
- 角色等待你回复的时间越长，压力等级越高（0-4级）
- 压力越高，定时消息间隔越短（1.0x → 0.2x），prompt 中注入焦虑情绪
- **回归反应**：你回复后，角色根据被冷落时长作出不同反应
  - 低压力 → 开心被安抚 😊
  - 中压力 → 轻微撒娇抱怨 😐
  - 高压力 → 欲求不满/生气 😡
- 回归反应只触发一次，之后压力归零
- 所有参数用户可调（最大等级、回归开关）
- 内置测试按钮：压力+1、测试触发、测试回归

#### 嫉妒悬浮窗 💢
- 切换角色聊天时，被离开的角色可能弹出嫉妒消息通知
- 通知型设计：右下角毛玻璃浮窗，显示头像+嫉妒消息
- **角色选择器**：可指定哪些角色会嫉妒（不选=不触发）
- **自定义 prompt**：可自行编写嫉妒提示词控制输出风格
- 可调参数：触发概率、最短/最长延迟
- 自动清理思维链/动作描写等干扰内容
- 内置测试按钮

### 🐛 Bug 修复

#### 后台轮询修复
- 使用 Web Worker 替代 `setInterval` 进行轮询
- 浏览器在后台标签页时不再被冻结/节流
- Worker 失败时自动回退到 `setInterval`

#### SillyTavern API 兼容
- 新增 `callGenerateQuietPrompt` 兼容层
- 自动适配新版（对象参数）和旧版（字符串参数）API
- 支持 SillyTavern 1.12.0 ~ 1.16.0+

### 📝 文档
- README 大幅更新：新功能说明、排查指南 FAQ、兼容性表格
- 新增常见问题排查表格（按 F12 日志内容定位问题）

### 📁 新增文件
- `poll-worker.js` — Web Worker 后台轮询

---

## v1.0.0

- 初始版本
- 定时自动消息
- 定时任务
- 桌面通知
- Server Plugin 后台运行
- Slash 命令
